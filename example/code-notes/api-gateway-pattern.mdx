---
title: Шаблон API gateway
tags:
    - microservices
created: 2021-05-01
---

Представим себе, что занимаемся созданием интернет-магазина, который будет представлять собой микросервисное приложение.
У нас стоит задача реализовать страницу сведений о продукте для нескольких клиентов:

* Веб-приложение для десктопных и мобильных браузеров,
* Мобильные приложения на Android и IOS, которые взаимодействуют с сервером через REST API, и могут иметь свои ограничения,
* Интернет-магазин должен предоставлять публичный API для использования сторонними системами, например, электронные точки продажи, приложения партнеров и т.д.

Поскольку интернет-магазин имеет микросервисную архитектуру, то данные о продукте могут распределяться по нескольких отдельным приложениям (сервисам)
В связи с этим возникают следующие проблемы:

* Необходимость выполнения нескольких запросов для получения данных, необходимых для клиента.
* Недостаточная инкапсуляция, связанная с тем, что клиенты знают о каждом сервисе и его API, что затрудняет внесение изменений в архитектуру и API.
* Разным клиентам нужны разные данные. Например, версия десктопная версия страницы со сведениями обычно содержит больше данных, чем мобильная.
* Сервисы могу использовать различные протоколы взаимодействия, и не все из них являются удобными с точки зрения использования клиентскими приложениями
* Микросервис со временем может быть подвергнут дальнейшему разделению, а также количество инстансов и их расположение

Решением проблемы может быть внедрение <Highlight>Gateway api</Highlight>, который является единой точкой входя для клиентов.
Некоторые запросы просто проксируются / перенаправляются в соответствующую службу. Другие же запросы обрабатываются, распределяясь по нескольким микросервисам:

![alt text](https://microservices.io/i/apigateway.jpg)

Также вместо универсального API, Gateway может предоставлять разные API для каждого клиента.
Если же API для каждого клиента выделить в отдельный Gateway API, то мы получим реализацию шаблона
<Highlight>Backend for Frontend</Highlight>.

![alt text](https://microservices.io/i/bffe.png)

Преимущества API Gateway:

* Инкапсулирует внутреннюю структуру приложения
* Упрощает клиент и уменьшает количество запросов, перемещая логику вызова нескольких служб с клиента на API Gateway
* Изолирует клиентов от определения местоположения экземпляров сервиса
* Решает проблему неудобных протоколов взаимодействия конкретных сервисов

Недостатки API Gateway:

* API gateway - еще один компонент, который нужно разрабатывать, администрировать, развертывать,
* Увеличение времени отклика, пускай даже и незначительное
* Увеличение времени разработки, ведь его следует обновлять каждый раз, когда выставляется наружу API очередного микросервиса