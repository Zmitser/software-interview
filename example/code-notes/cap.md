---
title: CAP теорема
tags:
    - microservice
created: 2021-05-22
---

В CAP говорится, что в распределенной системе возможно выбрать только 2 из 3-х свойств:

* C (consistency) — согласованность. Во всех вычислительных узлах в один момент времени данные не противоречат друг другу;
* A (availability) — доступность. Любой запрос к распределённой системе завершается корректным откликом, однако без гарантии, что ответы всех узлов системы совпадают;
* P (partition tolerance) — устойчивость к разделению. Разделение распределённой системы на несколько изолированных секций не приводит к некорректности отклика от каждой из секций.

![alt text](https://habrastorage.org/getpro/habr/post_images/5ea/6e0/5c6/5ea6e05c6e882b2c695570a487f7f1d0.gif)

###1. Postgresql

Следующие пункты относятся к абстрактной распределенной БД Postgresql.

* Репликация Master-Slave — одно из распространенных решений
* Синхронизация с Master в асинхронном / синхронном режиме
* Система транзакций использует двухфазный коммит для обеспечения consistency
* Если возникает partition, вы не можете взаимодейстовать с системой (в основном случае)

Таким образом, система не может продолжать работу в случае partition, но обеспечивает strong consistency и availability. Это система CA!

###2. MongoDB

Следующие пункты относятся к абстрактной распределенной БД MongoDB.

* MongoDB обеспечивает strong consistency, потому что это система с одним Master узлом, и все записи идут по умолчанию в него.
* Автоматическая смена мастера, в случае отделения его от остальных узлов.
* В случае разделения сети, система прекратит принимать записи до тех пор, пока не убедится, что может безопасно завершить их.

Таким образом, система может продолжать работу в случае разделения сети, но теряется CAP-availability всех узлов. Это CP система!

###3. Cassandra

Cassandra использует схему репликации master-master, что фактически означает AP систему, в которой разделение сети приводит к самодостаточному функционированию всех узлов.

